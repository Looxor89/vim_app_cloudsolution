<mvc:View displayBlock="true" controllerName="vim_ui.controller.DetailDetail" height="100%" xmlns:mvc="sap.ui.core.mvc" xmlns:f="sap.f" xmlns:l="sap.ui.layout" xmlns:u="sap.ui.unified" xmlns:m="sap.m" xmlns:form="sap.ui.layout.form" xmlns:core="sap.ui.core" xmlns:c="sap.suite.ui.commons" class="sapUiSizeCompact">

    <f:DynamicPage id="DDPage" toggleHeaderOnTitleClick="true" showFooter="true" stickySubheaderProvider="iconTabBar" headerExpanded="false" preserveHeaderStateOnScroll="true" class="sapUiNoContentPadding">
        <f:title>
            <f:DynamicPageTitle>

                <f:heading>
                    <m:FlexBox wrap="Wrap" fitContainer="true" alignItems="Center">
                        <m:Title text="Document Extraction - {appmodel>/detail/header/FILENAME}​​​​" wrapping="true" class="sapUiTinyMarginEnd" />
                    </m:FlexBox>
                </f:heading>
                <f:expandedContent>
                    <m:Label text="Locked By: {appmodel>/lock/LOCKEDBY}" visible="{path: 'appmodel>/lock/LOCKEDBY', formatter: '.formatter.formatLock'}" />
                </f:expandedContent>
                <f:snappedContent>
                    <m:Label text="Locked By: {appmodel>/lock/LOCKEDBY}" visible="{path: 'appmodel>/lock/LOCKEDBY', formatter: '.formatter.formatLock'}" />
                </f:snappedContent>

                <f:navigationActions>
                    <m:Button type="Emphasized" text="Edit Document" icon="sap-icon://edit" press="handleGEdit" visible="{ parts:['appmodel>/props/gEditMode', 'appmodel>/detail/header/DOC_STATUS', 'props>/action/admin'], formatter: '.formatter.detailDetailEdit' }" enabled="{props>/action/save}" />
                    <m:Button type="Emphasized" text="Cancel Edit" icon="sap-icon://edit-outside" press="handleCancelGEdit" visible="{ parts:['appmodel>/props/gEditMode', 'appmodel>/detail/header/DOC_STATUS' , 'props>/action/admin'] , formatter: '.formatter.detailDetailEditCancel' }" />
                    <!-- INIZIO: CAP elementi aggiunti in attesa di capire cosa fare con la Detail view -->
                    <m:Button text="Assign" icon="sap-icon://activity-individual" press="onForwardPress" 
                        visible="{ parts:['appmodel>/detail/header/DOC_STATUS', 'props>/action/assign'], formatter: '.formatter.allowActions' }"
                        >
                        <m:layoutData>
                            <m:OverflowToolbarLayoutData priority="AlwaysOverflow" closeOverflowOnInteraction="false" />
                        </m:layoutData>
                    </m:Button>
                    <m:Button text="Forward" icon="sap-icon://forward" press="onForwardPress" 
                        visible="{ parts:['appmodel>/detail/header/DOC_STATUS', 'props>/action/forward'], formatter: '.formatter.allowActions' }"
                        >
                        <m:layoutData>
                            <m:OverflowToolbarLayoutData priority="High" closeOverflowOnInteraction="false" />
                        </m:layoutData>
                    </m:Button>
                    <m:Button text="Reject" icon="sap-icon://employee-rejections" press="onRejectPress" 
                        type="Reject"
                        visible="{ parts:['appmodel>/detail/header/DOC_STATUS', 'props>/action/reject'], formatter: '.formatter.allowActions' }"
                        >
                        <m:layoutData>
                            <m:OverflowToolbarLayoutData priority="High" closeOverflowOnInteraction="false" />
                        </m:layoutData>
                    </m:Button>
                    <m:Button icon="sap-icon://decline" press="onCancelPress" tooltip="Close" type="Transparent">
                        <m:layoutData>
                            <m:OverflowToolbarLayoutData priority="High" closeOverflowOnInteraction="false" />
                        </m:layoutData>
                    </m:Button>
                    <!-- FINE: CAP elementi aggiunti in attesa di capire cosa fare con la Detail view -->
                    <!-- <m:OverflowToolbarButton type="Transparent" icon="sap-icon://full-screen" press="handleFullScreen" id="enterFullScreenBtn" tooltip="Enter Full Screen Mode" visible="{= ${/actionButtonsInfo/midColumn/fullScreen} !== null }" />
                    <m:OverflowToolbarButton type="Transparent" icon="sap-icon://exit-full-screen" press="handleExitFullScreen" id="exitFullScreenBtn" tooltip="Exit Full Screen Mode" visible="{= ${/actionButtonsInfo/midColumn/exitFullScreen} !== null }" /> CAP commento temporaneo -->
                    <m:OverflowToolbarButton type="Transparent" icon="sap-icon://decline" press="onCancelPress" tooltip="Close column" visible="{= ${/actionButtonsInfo/endColumn/closeColumn} !== null }" />
                    <m:OverflowToolbarButton id="messagePopoverBtn" visible="true" icon="sap-icon://message-popup" type="Emphasized" text="{=${msg>/aMsg}.length}" press=".handleMessagePopoverPress" ariaHasPopup="Dialog" />

                </f:navigationActions>

            </f:DynamicPageTitle>
        </f:title>

        <f:header>
            <f:DynamicPageHeader pinnable="false">
                <l:Grid>
                    <!-- <m:ObjectAttribute title="Extraction Status" text="{appmodel>/detail/header/DOX_STATUS}" /> -->
                    <m:ObjectAttribute title="Document Status" text="{appmodel>/detail/header/DOC_STATUS}" />
                    <m:ObjectAttribute title="Invoice Document Type" text="{appmodel>/detail/header/DOCUMENTTYPE}" />
                    <m:ObjectAttribute title="Type/Category" text="{appmodel>/detail/header/DOCCATEGORY}" />
                    <m:ObjectAttribute title="Assigned To" text="{appmodel>/detail/header/ASSIGNEDTO}" />
                    <m:ObjectAttribute title="Changed By" text="{appmodel>/detail/header/LASTCHANGEDBY}" />
                    <m:ObjectStatus title="Changed At" text="{path:'appmodel>/detail/header/LASTCHANGEDON', formatter:'.formatter.formatDateString'}" />
                </l:Grid>
            </f:DynamicPageHeader>
        </f:header>

        <f:content>
            <m:IconTabBar id="iconTabBar" applyContentPadding="false" class="sapUiNoContentPadding" expandable="false">
                <m:items>

                    <m:IconTabFilter text="Main Document">
                        <l:VerticalLayout class="sapUiNoContentPadding" width="100%" enabled="{appmodel>/props/gEditMode}">
                            <l:BlockLayout id="BlockLayout" background="Light">
                                <l:BlockLayoutRow>
                                    <l:BlockLayoutCell>
                                        <!-- CAP refactory: Inizio <l:HorizontalLayout>
                                            <m:Title text="Confidence Levels: " level="H1" class="sapUiSmallMargin" />
                                            <m:ObjectStatus class="sapUiSmallMargin" text="0% - 50%" inverted="true" state="Error" />
                                            <m:ObjectStatus class="sapUiSmallMargin" text="51% - 80%" inverted="true" state="Indication03" />
                                            <m:ObjectStatus class="sapUiSmallMargin" text="81% - 100%" inverted="true" state="Success" />
                                        </l:HorizontalLayout> CAP refactory: Fine -->

                                        <form:SimpleForm id="invoiceHeaderSimpleForm" editable="true" layout="ResponsiveGridLayout" columnsM="2" columnsL="3" columnsXL="3">
                                            <form:content>

                                                <core:Title text="General information" />
                                                <m:Label text="Purchase Order" visible="{= !${appmodel>/detailDetail/header/bMultiplePO}}"/>
                                                <m:Input id="idPurchaseOrder" value="{appmodel>/detailDetail/header/purchaseOrderNumber/value}"
                                                    visible="{= !${appmodel>/detailDetail/header/bMultiplePO}}"
                                                    tooltip="{ path: 'appmodel>/detailDetail/header/purchaseOrderNumber', formatter: '.formatter.genTooltip' }" 
                                                    change=".onPOInputChange" 
                                                    maxLength="10"/>
                                                <!-- <m:Input id="idPurchaseOrder" 
                                                    value="{appmodel>/detailDetail/header/purchaseOrderNumber/value}" 
                                                    change=".onPOInputChange" /> -->

                                                <!-- <m:Label text="Sender Name" visible="{= !${appmodel>/props/POMode}}" />
                                                <m:Input id="idSenderName" value="{appmodel>/detailDetail/header/senderName/value}" tooltip="{ path: 'appmodel>/detailDetail/header/senderName', formatter: '.formatter.genTooltip' }" visible="{= !${appmodel>/props/POMode}}" /> CAP refactory -->

                                                <!-- <m:Label text="Vendor Number" visible="{= !${appmodel>/props/POMode}}" required="true" />
                                                <m:Input id="idVendorNumber" value="{appmodel>/detail/edited/Vendor}" 
                                                    showValueHelp="true" submit=".onVendorChange" valueHelpRequest=".onVendorVH" 
                                                    visible="{= !${appmodel>/props/POMode}}" maxLength="10"/>

                                                <m:Label text="Receiver Name" visible="{= !${appmodel>/props/POMode}}" />
                                                <m:Input id="idReceiverName" value="{appmodel>/detailDetail/header/receiverName/value}" tooltip="{ path: 'appmodel>/detailDetail/header/receiverName', formatter: '.formatter.genTooltip' }" visible="{= !${appmodel>/props/POMode}}" /> CAP refactory  -->

                                                <m:Label text="Company Code" visible="{= !${appmodel>/props/POMode}}" required="true" />
                                                <!-- CAP refactory submit event is useless <m:Input id="idCompanyCode" value="{appmodel>/detail/edited/CompCode}" 
                                                    showValueHelp="true" submit=".onCompCodeChange" 
                                                    valueHelpRequest=".onCompCodeVH" visible="{= !${appmodel>/props/POMode}}" 
                                                    maxLength="4"/> -->
                                                
                                                <!-- <m:Input id="idCompanyCode" value="{appmodel>/detail/edited/CompCode}" 
                                                    showValueHelp="true"
                                                    valueHelpRequest=".onCompCodeVH" visible="{= !${appmodel>/props/POMode}}" 
                                                    maxLength="4"/>

                                                <m:Label text="Company Code" visible="{= ${appmodel>/props/POMode}}"/>
                                                <m:Text id="idCompanyCodeTxt" text="" visible="{= ${appmodel>/props/POMode}}" />CAP refactory  -->

                                                <m:Label text="Invoice receipt date" required="true" />
                                                <m:DatePicker id="idDocDate" value="{appmodel>/detailDetail/header/documentDate/value}" tooltip="{ path: 'appmodel>/detailDetail/header/documentDate', formatter: '.formatter.genTooltip' }" placeholder="MM/DD/YYYY" valueFormat="yyyy-dd-MM" displayFormat="MM/dd/yyyy" />
                                                
                                                <m:Label text="Invoice date" required="true" />
                                                <m:DatePicker id="idInvDate" value="{appmodel>/detailDetail/header/documentDate/value}" tooltip="{ path: 'appmodel>/detailDetail/header/documentDate', formatter: '.formatter.genTooltip' }" placeholder="MM/DD/YYYY" valueFormat="yyyy-dd-MM" displayFormat="MM/dd/yyyy" />

                                                <m:Label text="Baseline date" required="true" />
                                                <m:DatePicker id="idBaselineDate" value="{appmodel>/detailDetail/header/documentDate/value}" tooltip="{ path: 'appmodel>/detailDetail/header/documentDate', formatter: '.formatter.genTooltip' }" placeholder="DD/MM/YYYY" valueFormat="dd-MM-yyyy" displayFormat="dd/MM/yyyy" />

                                                <!-- <m:Label text="Invoice Number" required="true" />
                                                <m:Input id="idVendorInvoice" value="{appmodel>/detailDetail/header/documentNumber/value}" 
                                                    tooltip="{ path: 'appmodel>/detailDetail/header/documentNumber', formatter: '.formatter.genTooltip' }" 
                                                    maxLength="16"/>CAP refactory  -->

                                                <m:Label text="Invoicing party - Vendor code" required="true" />
                                                <m:Input id="idInvoicingPartyVendorCode"/>

                                                <m:Label text="Business area" required="true" />
                                                <m:Input id="idBusinessArea"/>

                                                <m:Label text="Assignment" required="true" />
                                                <m:Input id="idAssignment"/>

                                                <!-- <m:Label text="Due Date" visible="{= ${appmodel>/props/POMode}}" />
                                                <m:DatePicker id="idDueDate" placeholder="YYYY-DD-MM" valueFormat="yyyy-dd-MM" displayFormat="yyyy-dd-MM" change="handleDateChange" visible="{= ${appmodel>/props/POMode}}" /> -->
                                                <m:Label text="Posting date" visible="false" />
                                                <m:DatePicker id="idDueDate" placeholder="YYYY-DD-MM" valueFormat="yyyy-dd-MM" displayFormat="yyyy-dd-MM" change="handleDateChange" visible="false" />

                                                <m:Label text="Reference" required="true" />
                                                <m:Input id="idReference" />
                                                
                                                <m:Label text="Currency" required="true" />
                                                <m:Input id="idCurrency" value="{appmodel>/detailDetail/header/currencyCode/value}" 
                                                    tooltip="{ path: 'appmodel>/detailDetail/header/currencyCode', formatter: '.formatter.genTooltip' }" 
                                                    showValueHelp="true" valueHelpRequest=".onVHCurrency" 
                                                    maxLength="3"/>

                                                <m:Label text="Text" />
                                                <m:Input id="idFreeTxt" value="" maxLength="{ path: 'appmodel>/props/POMode', formatter: '.formatter.limitFreeTxt' }"/>

                                                <!-- <m:Label text="Credit Memo" />
                                                <m:CheckBox id="idInvInd" select=".onCredMemoToggle"/>CAP refactory  -->

                                                <core:Title text="Amounts" />
                                                <m:Label text="Gross Amount" required="true" />
                                                <m:Input id="idGrossAmt" 
                                                    value="{ path:'appmodel>/detailDetail/header/grossAmount/value'}" 
                                                    tooltip="{ path: 'appmodel>/detailDetail/header/grossAmount', formatter: '.formatter.genTooltip' }" 
                                                    type="Number" description="{appmodel>/detailDetail/header/currencyCode/value}" 
                                                    placeholder="0.00"
                                                    liveChange="calcTotals"
                                                    />

                                                <!-- <m:Label text="Discount Amount" visible="{= ${appmodel>/props/POMode}}" />
                                                <m:Input id="idDiscountAmt" value="" type="Number" description="{appmodel>/detailDetail/header/currencyCode/value}" placeholder="0.00" visible="{= ${appmodel>/props/POMode}}" /> -->
                                                <!-- NOT REQUIRED -->
                                                <!-- <m:Label text="Discount Amount" visible="false" />
                                                <m:Input id="idDiscountAmt" type="Number" 
                                                    value="{
                                                    type: 'sap.ui.model.odata.type.Decimal',
                                                    formatOptions: {
                                                        minFractionDigits: 1,
                                                        maxFractionDigits: 3
                                                    },
                                                    constraints: {
                                                        precision: 23,
                                                        scale: 4
                                                    }}"                                                     
                                                    description="{appmodel>/detailDetail/header/currencyCode/value}" 
                                                    placeholder="0.00" visible="false" />CAP refactory  -->
                                                <!-- Net amount visible=false -->
                                                <!-- <m:Label text="Net Amount" /> CAP refactory
                                                <m:Input id="idNetAmt"
                                                value="{ path:'appmodel>/detailDetail/header/netAmount/value',
                                                    type: 'sap.ui.model.odata.type.Decimal',
                                                    formatOptions: {
                                                      minFractionDigits: 1,
                                                      maxFractionDigits: 3
                                                    },
                                                    constraints: {
                                                      precision: 23,
                                                      scale: 4
                                                    }}"
                                                tooltip="{ path: 'appmodel>/detailDetail/header/netAmount', formatter: '.formatter.genTooltip' }" type="Number" description="{appmodel>/detailDetail/header/currencyCode/value}" placeholder="0.00" /> -->
                                                <m:Label text="Net Amount" />
                                                <m:Input id="idNetAmt" 
                                                    value="{ path:'appmodel>/detailDetail/header/netAmount/value'}" 
                                                    tooltip="{ path: 'appmodel>/detailDetail/header/netAmount', formatter: '.formatter.genTooltip' }" type="Number" description="{appmodel>/detailDetail/header/currencyCode/value}" placeholder="0.00" 
                                                    />

                                                <m:Label text="Payment Terms" />
                                                <!-- <m:Select id="idPaymentTerms" items="{appmodel>/valuehelps/paymentterms}">
                                                    <core:Item id="idPaymnttermSel" key="{appmodel>Paymentterms}" text="{appmodel>Paymentterms} - {appmodel>Description}" />
                                                </m:Select> -->
                                                <m:Input id="idPaymentTerms" showValueHelp="true" valueHelpRequest=".onPayTermsVH" />
                                                
                                                <m:Label text="Payment method" />
                                                <!-- <m:Select id="idPaymentTerms" items="{appmodel>/valuehelps/paymentterms}">
                                                    <core:Item id="idPaymnttermSel" key="{appmodel>Paymentterms}" text="{appmodel>Paymentterms} - {appmodel>Description}" />
                                                </m:Select> -->
                                                <m:Input id="idPaymentMethod" />
        

                                                <m:Label text="Invoice Document Type" />
                                                <m:Input id="idInvDocType" showValueHelp="true" valueHelpRequest=".onInvDocTypeVH" />

                                                <!-- <m:Toolbar ariaLabelledBy="idBankTitle" >
                                                    <m:Title id="idBankTitle" text="Banking Details" />
                                                </m:Toolbar>

                                                <m:Label text="Partner Bank Type" />CAP refactory  -->
                                                <!-- <m:ComboBox id="idBankKey" selectionChange="onBankSelect" enabled="{ 
                                                  parts: [
                                                  'appmodel>/props/POMode',
                                                  'appmodel>/detail/edited/Vendor'
                                                  ],
                                                  formatter: '.formatter.isVendor'
                                                }" items="{appmodel>/valuehelps/partbank}">
                                                    <core:Item key="{appmodel>Bvtyp}" text="{appmodel>Bvtyp}" />
                                                </m:ComboBox> -->
                                                <!-- <m:Input id="idBankKey" showValueHelp="true" valueHelpRequest=".onPartnerBankVH" />

                                                <m:Label text="Bank Acc #" />
                                                <m:Text id="bankntxt" text="{appmodel>/detailDetail/header/Bankn}" />CAP refactory  -->
                                                <!-- TODO -->
                                                <!-- <m:Label text="Routing #" />
                                                <m:Text id="routingtxt" text="{appmodel>/detailDetail/header/Bankl}" />
                                               
                                                <m:Label text="IBAN #" />
                                                <m:Text id="ibantxt" text="{appmodel>/detailDetail/header/IBAN}" />CAP refactory  -->

                                                <core:Title text="Tax" />
                                                <m:Label text="Tax Amount" />
                                                <m:Input id="idHTaxAmt" 
                                                    value="{
                                                    type: 'sap.ui.model.odata.type.Decimal',
                                                    formatOptions: {
                                                    minFractionDigits: 1,
                                                    maxFractionDigits: 3
                                                    },
                                                    constraints: {
                                                    precision: 23,
                                                    scale: 4
                                                    }}"
                                                    liveChange="calcTotals"
                                                    type="Number" description="{appmodel>/detailDetail/header/currencyCode/value}" 
                                                    placeholder="0.00" enabled="true" />

                                                <!-- <m:Label text="Withholding Exemption Amount" />
                                                <m:Input id="idTaxExemptAmt" value="{
                                                    type: 'sap.ui.model.odata.type.Decimal',
                                                    formatOptions: {
                                                    minFractionDigits: 1,
                                                    maxFractionDigits: 3
                                                    },
                                                    constraints: {
                                                    precision: 23,
                                                    scale: 4
                                                    }}" 
                                                    description="{appmodel>/detailDetail/header/currencyCode/value}"/> CAP refactory -->                                                    

                                                <m:Label text="Withholding tax code" />
                                                <m:Input id="idWithholdingTaxCode" />    

                                               <m:Label text="Tax Code" />
                                                <m:Select id="idTaxCode" enabled="{ 
                                                          parts: [
                                                          'appmodel>/props/POMode',
                                                          'appmodel>/detail/edited/CompCode'
                                                          ],
                                                          formatter: '.formatter.isTaxCode'
                                                        }" items="{appmodel>/valuehelps/taxcode}"
                                                        change=".onHeaderTaxCodeSelect"
                                                        >
                                                    <core:Item id="idTaxCodeTmp" key="{appmodel>Taxcode}" text="{appmodel>Taxcode} - {appmodel>Text}" />
                                                </m:Select>
                                                <!-- <m:Input id="idTaxCode" showValueHelp="true" valueHelpRequest=".onTaxCodeVH" /> -->

                                                <!-- <m:Label text="Calculate Tax" />
                                                <m:CheckBox id="idCalcTaxInd" select=".onCalcTax" />CAP refactory  -->

                                                <!-- <core:Title text="Unplanned Freight" visible="false"/> -->
                                                <!-- <m:Toolbar ariaLabelledBy="Title2" visible="{= ${appmodel>/props/POMode}}">
                                                    <m:Title id="Title2" text="Unplanned Freight" />
                                                    <m:ToolbarSpacer />
                                                </m:Toolbar>CAP refactory  -->

                                                <!-- <m:Label text="Delivery/Shipping Amount" visible="{= ${appmodel>/props/POMode}}" />
                                                <m:Input id="idShippingAmount" 
                                                    value="{
                                                    type: 'sap.ui.model.odata.type.Decimal',
                                                    formatOptions: {
                                                    minFractionDigits: 1,
                                                    maxFractionDigits: 3
                                                    },
                                                    constraints: {
                                                    precision: 23,
                                                    scale: 4
                                                    }}"
                                                    liveChange="calcTotals"
                                                    type="Number" description="{appmodel>/detailDetail/header/currencyCode/value}" 
                                                    placeholder="0.00" visible="{= ${appmodel>/props/POMode}}" />CAP refactory  -->

                                                <m:Toolbar ariaLabelledBy="LineItemsTypeTitle" visible="{= !${appmodel>/props/POMode}}">
                                                    <m:Title id="LineItemsTypeTitle" text="Line items type" visible="{= !${appmodel>/props/POMode}}"/>
                                                    <m:Select
                                                        id="idLineItemsType"
                                                        forceSelection="false"
                                                        change="onChangeGlAccountAsset"
                                                        visible="{= !${appmodel>/props/POMode}}">
                                                        <core:ListItem key="idGLAccountItem" text="G/L Account" />
                                                        <core:ListItem key="idAssetItem" text="Asset" />
                                                    </m:Select>
                                                </m:Toolbar>
                                            </form:content>
                                        </form:SimpleForm>
                                    </l:BlockLayoutCell>
                                </l:BlockLayoutRow>

                                <l:BlockLayoutRow visible="{= ${appmodel>/props/POMode}}">
                                    <l:BlockLayoutCell>
                                        <m:Table id="idInvLineItemTable" items="{
                                                    path: 'appmodel>/DocxLines',
                                                    sorter: {
                                                        path: 'Name'
                                                    }
                                                }" class="sapUiNoMargin">
                                            <m:headerToolbar>
                                                <m:Toolbar>
                                                    <m:Title text="Line Items ({= ${appmodel>/DocxLines/length}}) Purchase Order" level="H2" />
                                                    <m:ToolbarSpacer />
                                                    <m:Button text="Add" press="onAddRow" visible="{appmodel>/props/lineItemTable/editMode}" />
                                                    <m:Button text="Delete" press="onDeleteSelectedRows" visible="{appmodel>/props/lineItemTable/editMode}" />
                                                    <m:ToggleButton icon="sap-icon://edit" tooltip="Edit" press="onEditInvLineItems" visible="false" />
                                                </m:Toolbar>
                                            </m:headerToolbar>
                                            <m:columns>
                                                <m:Column minScreenWidth="Tablet" demandPopin="true">
                                                    <m:Label text="Doc. Line No." required="true"/>
                                                </m:Column>
                                                <m:Column minScreenWidth="Tablet" demandPopin="true" visible="{appmodel>/detailDetail/header/bMultiplePO}">
                                                    <m:Label text="Purchase Order" required="true"/>
                                                </m:Column>
                                                <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Label text="PO Line No." required="true"/>
                                                </m:Column>
                                                <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Label text="Amount" required="true"/>
                                                </m:Column>
                                                <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Label text="Qty" required="true"/>
                                                </m:Column>
                                                <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Label text="Order Unit" required="true"/>
                                                </m:Column>
                                                <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Text text="Description" />
                                                </m:Column>
                                                <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Label text="Tax Code" required="true"/>
                                                </m:Column>
                                                <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Label text="Business area" required="true"/>
                                                </m:Column>
                                                <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Label text="Cost center" required="true"/>
                                                </m:Column>
                                                <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Label text="WBS Element" required="true"/>
                                                </m:Column>
                                                <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Label text="Order" required="true"/>
                                                </m:Column>
                                                <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Label text="Supplier" required="true"/>
                                                </m:Column>
                                                <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Label text="Material" required="true"/>
                                                </m:Column>
                                                <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Label text="Valuation type" required="true"/>
                                                </m:Column>
                                                <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Label text="Material group" required="true"/>
                                                </m:Column>
                                                <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Label text="Plant" required="true"/>
                                                </m:Column>
                                                <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Label text="Valuation area" required="true"/>
                                                </m:Column>

                                            </m:columns>
                                            <m:items>
                                                <m:ColumnListItem id="readTemplate" vAlign="Middle">
                                                    <m:cells>
                                                        <m:Text text="{appmodel>InvoiceLineItem}" />
                                                        <m:Text text="{appmodel>PONumber}" visible="{appmodel>/detailDetail/header/bMultiplePO}" />
                                                        <m:Text text="{appmodel>PONumber} - {appmodel>POLineItem}" />
                                                        <m:Text text="{appmodel>Amount}" />
                                                        <m:Text text="{appmodel>Quantity}" />
                                                        <m:Text text="{appmodel>OrderUnit}" />
                                                        <m:Text text="{appmodel>Description}" wrapping="true" />
                                                        <m:Text text="{appmodel>TaxCode}" />
                                                        <m:Text text="{appmodel>BusinessArea}" />
                                                        <m:Text text="{appmodel>CostCenter}" />
                                                        <m:Text text="{appmodel>WBSElement}" />
                                                        <m:Text text="{appmodel>Order}" />
                                                        <m:Text text="{appmodel>Supplier}" />
                                                        <m:Text text="{appmodel>Material}" />
                                                        <m:Text text="{appmodel>ValuationType}" />
                                                        <m:Text text="{appmodel>MaterialGroup}" />
                                                        <m:Text text="{appmodel>Plant}" />
                                                        <m:Text text="{appmodel>ValuationArea}" />
                                                    </m:cells>

                                                </m:ColumnListItem>
                                            </m:items>
                                        </m:Table>

                                        <!-- CAP refactory <m:Table id="idTotalAmountTable" autoPopinMode="true" class="sapUiNoMargin">
                                            <m:columns>
                                                <m:Column>
                                                    <m:Text text="Balance Amount" />
                                                </m:Column>
                                            </m:columns>
                                            <m:items>
                                                <m:ColumnListItem vAlign="Middle">
                                                    <m:cells>
                                                        <m:Text text="{appmodel>/props/totalAmount}" />
                                                    </m:cells>
                                                </m:ColumnListItem>
                                            </m:items>
                                        </m:Table> -->

                                    </l:BlockLayoutCell>
                                </l:BlockLayoutRow>

                                <l:BlockLayoutRow visible="{ parts:['appmodel>/props/POMode', 'appmodel>/props/NONPOModeGLaccount'], formatter: '.formatter.allowGLAccountTable' }">
                                    <l:BlockLayoutCell>
                                        <m:Table id="idNPOInvGLAccountLineTable" items="{
                                                    path: 'appmodel>/NonPoDocxLines'
                                                }" autoPopinMode="true" class="sapUiNoMargin">
                                            <m:headerToolbar>
                                                <m:Toolbar>
                                                    <m:Title text="Line Items ({= ${appmodel>/NonPoDocxLines/length}}) G/L Account" level="H2" />
                                                    <m:ToolbarSpacer />
                                                    <m:Button text="Add" press="onAddRow" visible="{appmodel>/props/lineItemTable/editMode}" />
                                                    <m:Button text="Delete" press="onDeleteSelectedRows" visible="{appmodel>/props/lineItemTable/editMode}" />
                                                    <m:ToggleButton icon="sap-icon://edit" tooltip="Edit" press="onEditInvLineItems" visible="false" />
                                                </m:Toolbar>
                                            </m:headerToolbar>
                                            <m:columns>
                                                <m:Column minScreenWidth="Tablet" demandPopin="true">
                                                    <m:Text text="Doc. Line No." />
                                                </m:Column>
                                                <!-- <m:Column minScreenWidth="Tablet" demandPopin="true">
                                                    <m:Text text="D/C" />
                                                </m:Column> -->
                                                <!-- <m:Column>
                                                    <m:Text text="Description" />
                                                </m:Column> -->
                                                <!-- <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Text text="Company Code" />
                                                </m:Column> -->
                                                <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Text text="G/L Account" />
                                                </m:Column>
                                                <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Text text="Amount" />
                                                </m:Column>
                                                <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Text text="Tax Code" />
                                                </m:Column>
                                                <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Text text="Assignment" />
                                                </m:Column>
                                                <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Text text="Text" />
                                                </m:Column>
                                                <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Text text="Business area" />
                                                </m:Column>
                                                <!-- <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Text text="Tax Amount" />
                                                </m:Column> -->
                                                <!-- <m:Column>
                                                    <m:Text text="Quantity" /> -->
                                                <!-- </m:Column> -->
                                                <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Text text="Cost Center" />
                                                </m:Column>
                                                <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Text text="Order" />
                                                </m:Column>
                                                <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Text text="Sales order" />
                                                </m:Column>
                                                <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Text text="Profit Center" />
                                                </m:Column>
                                                <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Text text="WBS Element" />
                                                </m:Column>

                                            </m:columns>
                                            <m:items>
                                                <m:ColumnListItem id="readNonPOGLAccountTemplate" vAlign="Middle">
                                                    <m:cells>
                                                        <m:Text text="{appmodel>InvoiceLineItem}" />
                                                        <!-- <m:Text text="{ path:'appmodel>CDInd', formatter: '.formatter.parseCDInd' }" /> -->
                                                        <!-- <m:Text text="{appmodel>Description}" wrapping="true"/> -->
                                                        <!-- <m:Text text="{appmodel>Bukrs}" /> -->
                                                        <m:Text text="{appmodel>GLAcc}"/>
                                                        <m:Text text="{appmodel>Amount}" />
                                                        <m:Text text="{appmodel>TaxCode}"/>
                                                        <!-- <m:Text text="{appmodel>TaxAmount}" /> -->
                                                        <!-- <m:Input value="{appmodel>Quantity}" /> -->
                                                        <m:Text text="{appmodel>Assignment}"/>
                                                        <m:Text text="{appmodel>Text}"/>
                                                        <m:Text text="{appmodel>BusinessArea}"/>
                                                        <m:Text text="{appmodel>Order}"/>
                                                        <m:Text text="{appmodel>SalesOrder}"/>
                                                        <m:Text text="{appmodel>CostCen}"/>
                                                        <m:Text text="{appmodel>ProfitCen}" />
                                                        <m:Text text="{appmodel>WBSElem}" />
                                                    </m:cells>
                                                </m:ColumnListItem>
                                            </m:items>
                                        </m:Table>

                                        <m:Table id="idTotalAmountGLAccountTable2" autoPopinMode="true" class="sapUiNoMargin">
                                            <m:columns>
                                                <m:Column>
                                                    <m:Text text="Balance Amount" />
                                                </m:Column>
                                            </m:columns>
                                            <m:items>
                                                <m:ColumnListItem vAlign="Middle">
                                                    <m:cells>
                                                        <m:Text text="{appmodel>/props/totalAmount}" />
                                                    </m:cells>
                                                </m:ColumnListItem>
                                            </m:items>
                                        </m:Table>
                                    </l:BlockLayoutCell>
                                </l:BlockLayoutRow>
                                <l:BlockLayoutRow visible="{ parts:['appmodel>/props/POMode', 'appmodel>/props/NONPOModeGLaccount'], formatter: '.formatter.allowAssetTable' }">
                                    <l:BlockLayoutCell>
                                        <m:Table id="idNPOInvAssetLineTable" items="{
                                                    path: 'appmodel>/NonPoDocxLines'
                                                }" autoPopinMode="true" class="sapUiNoMargin">
                                            <m:headerToolbar>
                                                <m:Toolbar>
                                                    <m:Title text="Line Items ({= ${appmodel>/NonPoDocxLines/length}}) Asset" level="H2" />
                                                    <m:ToolbarSpacer />
                                                    <m:Button text="Add" press="onAddRow" visible="{appmodel>/props/lineItemTable/editMode}" />
                                                    <m:Button text="Delete" press="onDeleteSelectedRows" visible="{appmodel>/props/lineItemTable/editMode}" />
                                                    <m:ToggleButton icon="sap-icon://edit" tooltip="Edit" press="onEditInvLineItems" visible="false" />
                                                </m:Toolbar>
                                            </m:headerToolbar>
                                            <m:columns>
                                                <m:Column minScreenWidth="Tablet" demandPopin="true">
                                                    <m:Text text="Doc. Line No." />
                                                </m:Column>
                                                <!-- <m:Column minScreenWidth="Tablet" demandPopin="true">
                                                    <m:Text text="D/C" />
                                                </m:Column> -->
                                                <!-- <m:Column>
                                                    <m:Text text="Description" />
                                                </m:Column> -->
                                                <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Text text="Company Code" />
                                                </m:Column>
                                                <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Text text="Asset number" />
                                                </m:Column>
                                                <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Text text="Asset secondary number" />
                                                </m:Column>
                                                <!-- <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Text text="G/L Account" />
                                                </m:Column> -->
                                                <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Text text="Amount" />
                                                </m:Column>
                                                <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Text text="Quantity" />
                                                </m:Column>
                                                <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Text text="Base unit of measure" />
                                                </m:Column>
                                                <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Text text="Tax Code" />
                                                </m:Column>
                                                <!-- <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Text text="Tax Amount" />
                                                </m:Column> -->
                                                <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Text text="Assignment" />
                                                </m:Column>
                                                <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Text text="Text" />
                                                </m:Column>
                                                <!-- <m:Column>
                                                    <m:Text text="Quantity" /> -->
                                                <!-- </m:Column> -->
                                                <!-- <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Text text="Cost Center" />
                                                </m:Column> -->
                                                <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Text text="Profit Center" />
                                                </m:Column>
                                                <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Text text="Asset value date" />
                                                </m:Column>
                                                <!-- <m:Column minScreenWidth="Desktop" demandPopin="true">
                                                    <m:Text text="WBS Element" />
                                                </m:Column> -->

                                            </m:columns>
                                            <m:items>
                                                <m:ColumnListItem id="readNonPOAssetTemplate" vAlign="Middle">
                                                    <m:cells>
                                                        <m:Text text="{appmodel>InvoiceLineItem}" />
                                                        <!-- <m:Text text="{ path:'appmodel>CDInd', formatter: '.formatter.parseCDInd' }" /> -->
                                                        <!-- <m:Text text="{appmodel>Description}" wrapping="true"/> -->
                                                        <m:Text text="{appmodel>Bukrs}" />
                                                        <!-- <m:Text text="{appmodel>GLAcc}"/> -->
                                                        <m:Text text="{appmodel>AssetNumber}"/>
                                                        <m:Text text="{appmodel>AssetSecondaryNumber}"/>
                                                        <m:Text text="{appmodel>Amount}" />
                                                        <m:Text text="{appmodel>Quantity}" />
                                                        <m:Text text="{appmodel>BaseUnitOfMeasure}"/>
                                                        <m:Text text="{appmodel>TaxCode}"/>
                                                        <m:Text text="{appmodel>Assignment}"/>
                                                        <m:Text text="{appmodel>Text}"/>
                                                        <!-- <m:Text text="{appmodel>TaxAmount}" /> -->
                                                        <!-- <m:Input value="{appmodel>Quantity}" /> -->
                                                        <!-- <m:Text text="{appmodel>CostCen}"/> -->
                                                        <m:Text text="{appmodel>ProfitCen}" />
                                                        <m:Text text="{appmodel>AssetValueDate}" />
                                                        <!-- <m:Text text="{appmodel>WBSElem}" /> -->
                                                    </m:cells>
                                                </m:ColumnListItem>
                                            </m:items>
                                        </m:Table>

                                        <m:Table id="idTotalAmountAssetTable2" autoPopinMode="true" class="sapUiNoMargin">
                                            <m:columns>
                                                <m:Column>
                                                    <m:Text text="Balance Amount" />
                                                </m:Column>
                                            </m:columns>
                                            <m:items>
                                                <m:ColumnListItem vAlign="Middle">
                                                    <m:cells>
                                                        <m:Text text="{appmodel>/props/totalAmount}" />
                                                    </m:cells>
                                                </m:ColumnListItem>
                                            </m:items>
                                        </m:Table>
                                    </l:BlockLayoutCell>
                                </l:BlockLayoutRow>
                            </l:BlockLayout>
                        </l:VerticalLayout>
                    </m:IconTabFilter>

                    <m:IconTabFilter text="Additional Information">
                        <l:VerticalLayout class="sapUiNoContentPadding" width="100%">
                            <l:BlockLayout background="Light">
                                <l:BlockLayoutRow>
                                    <l:BlockLayoutCell class="sapUiContentPadding" visible="{props>/action/comment}">
                                        <m:VBox>
                                            <m:Title text="Notes"></m:Title>
                                            <m:TextArea id="idNotesTxtArea" rows="8" width="100%" />
                                            <m:Button text="Post Note" press=".onAddNotes" width="100%" />
                                            <m:Button text="Clear" press=".onClearNotes" width="100%" />
                                        </m:VBox>

                                    </l:BlockLayoutCell>
                                    <l:BlockLayoutCell>
                                        <m:VBox>
                                            <m:ScrollContainer height="300px" width="100%" vertical="true" focusable="true">
                                                <c:Timeline enableDoubleSided="false" sortOldestFirst="false" growingThreshold="300" content="{appmodel>/notes}" enableScroll="false" axisOrientation="Vertical" showHeaderBar="false" noDataText="No data">
                                                    <c:content>
                                                        <c:TimelineItem dateTime="{path:'appmodel>CreatedAt', formatter:'.formatter.formatDateString'}" title="{appmodel>Subject}" text="{appmodel>Note}" userName="{appmodel>CreatedBy}"></c:TimelineItem>
                                                    </c:content>
                                                </c:Timeline>
                                            </m:ScrollContainer>
                                        </m:VBox>
                                    </l:BlockLayoutCell>
                                </l:BlockLayoutRow>
                                <l:BlockLayoutRow>
                                    <l:BlockLayoutCell>
                                        <m:Table id="idFileList" items="{appmodel>/Filelist}" class="sapUiNoMargin">
                                            <m:headerToolbar>
                                                <m:Toolbar>
                                                    <m:Title text="Files " level="H2" />
                                                    <m:ToolbarSpacer />

                                                    <u:FileUploader width="600px" id="fileUploader" uploadUrl="/api/objstore/upload2" change="handleFileChange" style="Emphasized" name="file" uploadComplete="handleUploadComplete" sendXHR="true" fileType="txt,jpg,png,doc,docx,xls,xlsx,pdf,ppt,pptx,zip" placeholder="Choose a file for Upload..." visible="{appmodel>/props/FileEditMode}" />

                                                    <m:Button icon="sap-icon://upload" press="handleUploadPress" tooltip="Upload file" visible="{appmodel>/props/FileEditMode}" />
                                                    <m:ToggleButton icon="sap-icon://edit" press="onFileListEdit" visible="{props>/action/upload}" />

                                                </m:Toolbar>
                                            </m:headerToolbar>
                                            <m:columns>
                                                <m:Column>
                                                    <m:Text text="File" />
                                                </m:Column>
                                                <m:Column>
                                                    <m:Text text="Document Type" />
                                                </m:Column>
                                                <!-- <m:Column>
                                                    <m:Text text="Category" /> CAP refactory
                                                </m:Column> -->
                                                <!-- <m:Column>
                                                    <m:Text text="Extraction Status" /> CAP refactory
                                                </m:Column> -->
                                                <!-- <m:Column>
                                                        <m:Text text="Job Id" />
                                                    </m:Column> -->
                                                <!-- <m:Column>
                                                    <m:Text text="Primary Document" /> CAP refactory
                                                </m:Column> -->

                                            </m:columns>
                                            <m:items>
                                                <m:ColumnListItem vAlign="Middle">
                                                    <m:cells>
                                                        <!-- <m:Link text="{appmodel>nomeAttachment}" href="{path: 'appmodel>ObjectStoreRef', formatter: '.formatter.formatLink'}" /> CAP refactory  -->
                                                        <m:Link text="{appmodel>nomeAttachment}" press="onDownloadAttachment" />
                                                        <m:Text text="{appmodel>formatoAttachment}" />
                                                        <!-- <m:Text text="{appmodel>DocCategory}" /> CAP refactory -->
                                                        <!-- <m:Text text="{appmodel>DoxStatus}" /> CAP refactory -->
                                                        <!-- <m:RadioButton selected="{= ${appmodel>IsMain}}" enabled="{appmodel>/props/FileEditMode}" visible="{= ${appmodel>DoxStatus} ? true : false }" select=".onFileListMainSelect" groupName="FileList" /> CAP refactory -->
                                                    </m:cells>
                                                </m:ColumnListItem>
                                            </m:items>
                                        </m:Table>
                                    </l:BlockLayoutCell>
                                </l:BlockLayoutRow>
                            </l:BlockLayout>
                        </l:VerticalLayout>
                    </m:IconTabFilter>
                </m:items>
            </m:IconTabBar>
        </f:content>
        <f:footer>
            <m:OverflowToolbar visible="{appmodel>/props/gEditMode}">
                <m:ToolbarSpacer />
                <m:Button type="Reject" text="Reject" press="onRejectPress" icon="sap-icon://employee-rejections" 
                    visible="{ parts:['appmodel>/detail/header/DOCSTATUS', 'props>/action/reject'], formatter: '.formatter.allowActions' }"
                    />
                <m:Button type="Default" text="Forward" press="onForwardPress" icon="sap-icon://forward" 
                    visible="{ parts:['appmodel>/detail/header/DOCSTATUS', 'props>/action/forward'], formatter: '.formatter.allowActions' }"
                    />
                <m:Button type="Emphasized" text="Save" icon="sap-icon://save" visible="{props>/action/save}" press=".onSavePress" />
                <m:Button type="Accept" text="Submit" icon="sap-icon://accept" visible="{props>/action/savesap}" press=".onSubmitPress" />
            </m:OverflowToolbar>
        </f:footer>
    </f:DynamicPage>

</mvc:View>